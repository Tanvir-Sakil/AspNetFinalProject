@using DevSkill.Inventory.Web.Areas.Customers.Models
@model CustomerLedgerModel
@{
    ViewData["Title"] = "Customer Ledger";
}
@section Styles {
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.2.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        .select2-container--bootstrap-5 .select2-selection {
            min-height: calc(2.25rem + 2px); 
            padding: 0.375rem 0.75rem;
            font-size: 1rem;
        }

        .select2-container--bootstrap-5 .select2-selection__arrow {
            top: 8px; 
        }

        .select2-container--bootstrap-5.select2-container--focus .select2-selection {
            border-color: #86b7fe;
            box-shadow: 0 0 0 0.25rem rgba(13,110,253,.25);
        }

        .select2-container {
            z-index: 9999 !important;
        }

        .select2-dropdown {
            z-index: 99999 !important;
        }

        .select2-container {
            z-index: 1055;
        }

        .select2-dropdown {
            z-index: 1060; 
        }
        .card-body {
            overflow: visible !important;
            position: relative;
        }
    </style>
}


<h2>Customer Ledger</h2>

<form asp-action="GenerateReport" asp-controller="Ledger" method="get">
    <div class="card">
        <div class="card-body">
            <div class="form-group">
                <b>Report Type:</b><br />
                <input asp-for="ReportType" type="radio" value="ocust" /> Customer All Ledger &nbsp;&nbsp;
                <input asp-for="ReportType" type="radio" value="dailyReports" /> Daily Ledger &nbsp;&nbsp;
                <input asp-for="ReportType" type="radio" value="monthlyReports" /> Monthly Ledger &nbsp;&nbsp;
                <input asp-for="ReportType" type="radio" value="yearlyReports" /> Yearly Ledger
            </div>

            <div id="dailySection" class="d-none">
                <div class="form-row">
                    <div class="form-group col-md-3">
                        <label for="StartDate">Start Date</label>
                        <input asp-for="StartDate" class="form-control" type="date" />
                    </div>
                    <div class="form-group col-md-3">
                        <label for="EndDate">End Date</label>
                        <input asp-for="EndDate" class="form-control" type="date" />
                    </div>
                </div>
            </div>

            <div id="monthlySection" class="d-none">
                <div class="form-row">
                    <div class="form-group col-md-3">
                        <label for="Month">Select Month</label>
                        <select asp-for="Month" class="form-control">
                            <option value="">Select One</option>
                            @for (int i = 1; i <= 12; i++)
                            {
                                <option value="@i">@System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName(i)</option>
                            }
                        </select>
                    </div>
                    <div class="form-group col-md-3">
                        <label for="Year">Select Year</label>
                        <select asp-for="Year" class="form-control">
                            <option value="">Select One</option>
                            @for (int y = 2020; y <= DateTime.Now.Year + 1; y++)
                            {
                                <option value="@y">@y</option>
                            }
                        </select>
                    </div>
                </div>
            </div>

            <div id="yearlySection" class="d-none">
                <div class="form-row">
                    <div class="form-group col-md-3">
                        <label for="ReportYear">Select Year</label>
                        <select asp-for="ReportYear" class="form-control">
                            <option value="">Select One</option>
                            @for (int y = 2020; y <= DateTime.Now.Year + 1; y++)
                            {
                                <option value="@y">@y</option>
                            }
                        </select>
                    </div>
                </div>
            </div>
            <div class="form-group mt-3">
                <label for="CustomerId">Select Customer</label>
                <select asp-for="CustomerId" class="form-control customer-select" style="width:100%"></select>
            </div>

            <button type="submit" class="btn btn-primary mt-3">
                <i class="fa fa-search"></i> Search
            </button>
        </div>
    </div>
</form>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        $(document).ready(function () {
            function initCustomerSelect(selector) {
                console.log("Initializing Select2 on", selector);
                $(selector).select2({
                    theme: 'bootstrap-5',  
                    placeholder: "Search for customer",
                    minimumInputLength: 2,
                    ajax: {
                        url: '/Customers/SearchCustomers',
                        dataType: 'json',
                        delay: 250,
                        data: function (params) {
                            return { query: params.term };
                        },
                        processResults: function (data) {
                            return { results: data };
                        },
                        cache: true
                    }
                });
            }

            function toggleSections() {
                $('#dailySection, #monthlySection, #yearlySection').addClass('d-none');
                const type = $('input[name="ReportType"]:checked').val();
                if (type === 'dailyReports') $('#dailySection').removeClass('d-none');
                else if (type === 'monthlyReports') $('#monthlySection').removeClass('d-none');
                else if (type === 'yearlyReports') $('#yearlySection').removeClass('d-none');
            }

            initCustomerSelect('.customer-select');
            toggleSections();
            $('input[name="ReportType"]').change(toggleSections);
        });

    </script>
}
