@using DevSkill.Inventory.Domain.Dtos
@model SaleDto
@{
    ViewData["Title"] = "Sale Invoice";
}

@section Styles {
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        .invoice {
            background: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 0 10px rgba(0,0,0,0.08);
            max-width: 1000px;
            margin: auto;
        }

        .inv {
            background-color: #f2f2f2;
            padding: 30px 0;
            margin: 0px 35px;
            border-radius: 10rem;
            color: black;
            text-align: center;
        }

        @@media print {
            .no-print

        {
            display: none !important;
        }

        #printOnly {
            position: fixed;
            bottom: 0;
            width: 100%;
        }

        }
    </style>
}

<div class="card-body">
    <div class="invoice p-3 mb-3">
        <div id="print">
            <div class="row invoice-info mb-3">
                <div class="col-md-4 text-start">
                    <img src="@Model.CompanyProfileView.LogoPath" style="width: 50%; height: auto;" />
                </div>
                <div class="col-md-4 text-center">
                    <address>
                        @Model.CompanyProfileView.Address<br />
                        @Model.CompanyProfileView.Email<br />
                        Contact No.: @Model.CompanyProfileView.Mobile<br />
                        @Model.CompanyProfileView.Web
                    </address>
                </div>
            </div>

            <hr />
            <div class="row invoice-info justify-content-center text-center mb-4">
                <div class="col-md-4">
                    <table class="table table-sm">
                        <tbody>
                            <tr><td><b>Order Date:</b></td><td>@Model.Date.ToString("dd-MM-yyyy")</td></tr>
                            <tr><td><b>Order Time:</b></td><td>@DateTime.Now.ToString("hh:mm tt")</td></tr>
                            <tr><td><b>Company:</b></td><td>@Model.CompanyProfileView.CompanyName</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-md-4 d-flex align-items-center justify-content-center">
                    <div class="inv">
                        <h4>Sale Invoice</h4>
                    </div>
                </div>
                <div class="col-md-4">
                    <table class="table table-sm">
                        <tbody>
                            <tr><td><b>Invoice No:</b></td><td>@Model.InvoiceNo</td></tr>
                            <tr><td><b>Customer:</b></td><td>@Model.CustomerName</td></tr>
                            <tr><td><b>Address:</b></td><td>@Model.CustomerAddress</td></tr>
                            <tr><td><b>Contact No:</b></td><td>@Model.CustomerContact</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Product Table -->
            <table class="table table-striped">
                <thead class="table-primary">
                    <tr>
                        <th>SL</th>
                        <th>Product</th>
                        <th>Quantity</th>
                        <th>Unit</th>
                        <th>Unit Price</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        int sl = 1;
                        foreach (var item in Model.Items)
                        {
                            <tr>
                                <td>@sl</td>
                                <td>@item.ProductName</td>
                                <td>@item.Quantity</td>
                                <td>@item.UnitPrice.ToString("0.00")</td>
                                <td>@item.SubTotal.ToString("0.00")</td>
                            </tr>
                            ;
                            sl++;
                        }
                    }
                </tbody>
                <tfoot>
                    <tr><td colspan="5" class="text-end"><b>VAT</b></td><td>@Model.VAT.ToString("0.00")</td></tr>
                    <tr><td colspan="5" class="text-end"><b>Discount</b></td><td>@Model.Discount.ToString("0.00")</td></tr>
                    <tr><td colspan="5" class="text-end text-primary"><b>Total Amount</b></td><td class="text-primary">@Model.TotalAmount.ToString("0.00")</td></tr>
                    <tr><td colspan="5" class="text-end"><b>Net Total</b></td><td>@Model.NetTotal.ToString("0.00")</td></tr>
                    <tr><td colspan="5" class="text-end text-success"><b>Paid Amount</b></td><td class="text-success">@Model.PaidAmount.ToString("0.00")</td></tr>
                    <tr><td colspan="5" class="text-end text-danger"><b>Current Due</b></td><td class="text-danger">@Model.DueAmount.ToString("0.00")</td></tr>
                </tfoot>
            </table>

            <div class="row text-center mt-5" id="printOnly">
                <div class="col-md-3"><p>------------------------------</p><p>Customer</p></div>
                <div class="col-md-3"><p>------------------------------</p><p>Prepared By</p></div>
                <div class="col-md-3"><p>------------------------------</p><p>Verified By</p></div>
                <div class="col-md-3"><p>------------------------------</p><p>Authorized By</p></div>
            </div>
        </div>
        <div class="row no-print text-center mt-4">
            <div class="col-12">
                <a href="javascript:void(0)" class="btn btn-primary me-2" onclick="printDiv('print')">
                    <i class="fas fa-print"></i> Print
                </a>
                <a href="@Url.Action("Index", "Sales")" class="btn btn-danger">
                    <i class="fas fa-arrow-left"></i> Back
                </a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function printDiv(divId) {
            const printContents = document.getElementById(divId).innerHTML;
            const originalContents = document.body.innerHTML;
            document.body.innerHTML = printContents;
            window.print();
            document.body.innerHTML = originalContents;
            location.reload();
        }
    </script>
}
